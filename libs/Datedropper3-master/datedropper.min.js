// API https://felicegattuso.com/projects/datedropper/
!function(x){var a="transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",e="webkitAnimationEnd mozAnimationEnd oAnimationEnd oanimationend animationend",D={en:{name:"English",gregorian:!1,months:{short:["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"],full:["January","February","March","April","May","June","July","August","September","October","November","December"]},weekdays:{short:["S","M","T","W","T","F","S"],full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},ru:{name:"русский язык",gregorian:!0,months:{short:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],full:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"]},weekdays:{short:["вс","пн","вт","ср","чт","пт","сб"],full:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"]}}},T={},M=null,j=!1,l=null,n=null,d=null,r=!1,c=function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},t=function(){M&&T[M.id].fx&&!T[M.id].fxmobile&&(x(window).width()<480?M.element.removeClass("picker-fxs"):M.element.addClass("picker-fxs"))},s=function(){var i=O(m()),a=O(u());if(T[M.id].lock){if("from"==T[M.id].lock)return i<a?(H(),M.element.addClass("picker-lkd"),!0):(M.element.removeClass("picker-lkd"),!1);if("to"==T[M.id].lock)return a<i?(H(),M.element.addClass("picker-lkd"),!0):(M.element.removeClass("picker-lkd"),!1)}if(T[M.id].disabledays)return-1!=T[M.id].disabledays.indexOf(i)?(H(),M.element.addClass("picker-lkd"),!0):(M.element.removeClass("picker-lkd"),!1)},A=function(i){return i%1==0},E=function(i){return/(^\d{1,4}[\.|\\/|-]\d{1,2}[\.|\\/|-]\d{1,4})(\s*(?:0?[1-9]:[0-5]|1(?=[012])\d:[0-5])\d\s*[ap]m)?$/.test(i)},p=function(i){return parseInt(T[M.id].key[i].current)},k=function(i){return parseInt(T[M.id].key[i].today)},u=function(){return k("m")+"/"+k("d")+"/"+k("y")},m=function(){return p("m")+"/"+p("d")+"/"+p("y")},f=function(i,a){for(var e=[],t=T[M.id].key[i],l=t.min;l<=t.max;l++)l%a==0&&e.push(l);return e},y=function(i,a){var e=T[M.id].key[i];return a>e.max?y(i,a-e.max+(e.min-1)):a<e.min?y(i,a+1+(e.max-e.min)):a},Y=function(){return D[T[M.id].lang].gregorian?[1,2,3,4,5,6,0]:[0,1,2,3,4,5,6]},g=function(i){return F('ul.pick[data-k="'+i+'"]')},h=function(i,a){ul=g(i);var e=[];return ul.find("li").each(function(){e.push(x(this).attr("value"))}),"last"==a?e[e.length-1]:e[0]},F=function(i){if(M)return M.element.find(i)},O=function(i){return Date.parse(i)/1e3},v=function(){T[M.id].large&&(M.element.toggleClass("picker-lg"),z())},b=function(){F("ul.pick.pick-l").toggleClass("visible")},w=function(){if(!M.element.hasClass("picker-modal")){var i=M.input,a=i.offset().left+i.outerHeight()/2,e=i.offset().top+i.outerHeight();M.element.css({left:a,top:e})}},C=function(){var a=Y();F(".pick-lg .pick-lg-h li").each(function(i){x(this).html(D[T[M.id].lang].weekdays.short[a[i]])}),F("ul.pick.pick-m li").each(function(){x(this).html(D[T[M.id].lang].months.short[x(this).attr("value")-1])})},S=function(){s()||(M.element.removeClass("picker-focus"),M.element.hasClass("picker-modal")&&x(".picker-modal-overlay").addClass("tohide"),M=null),j=!1},J=function(a){var e=g(a),t=T[M.id].key[a];for(T[M.id].key[a].current=t.today<t.min&&t.min||t.today,i=t.min;i<=t.max;i++){var l=i;"m"==a&&(l=D[T[M.id].lang].months.short[i-1]),"l"==a&&(l=D[Object.keys(D)[i]].name),l+="d"==a?"<span></span>":"",x("<li>",{value:i,html:l}).appendTo(e)}x("<div>",{class:"pick-arw pick-arw-s1 pick-arw-l",html:x("<i>",{class:"pick-i-l"})}).appendTo(e),x("<div>",{class:"pick-arw pick-arw-s1 pick-arw-r",html:x("<i>",{class:"pick-i-r"})}).appendTo(e),"y"==a&&(x("<div>",{class:"pick-arw pick-arw-s2 pick-arw-l",html:x("<i>",{class:"pick-i-l"})}).appendTo(e),x("<div>",{class:"pick-arw pick-arw-s2 pick-arw-r",html:x("<i>",{class:"pick-i-r"})}).appendTo(e)),I(a,p(a))},z=function(){var i=0,a=F(".pick-lg-b");a.find("li").empty().removeClass("pick-n pick-b pick-a pick-v pick-lk pick-sl pick-h").attr("data-value","");new Date(m());var e=new Date(m()),t=new Date(m()),l=function(i){var a=i.getMonth(),e=i.getFullYear();return[31,e%4==0&&(e%100!=0||e%400==0)?29:28,31,30,31,30,31,31,30,31,30,31][a]};t.setMonth(t.getMonth()-1),e.setDate(1);var n=e.getDay()-1;n<0&&(n=6),D[T[M.id].lang].gregorian&&--n<0&&(n=6);for(var d=l(t)-n;d<=l(t);d++)a.find("li").eq(i).html(d).addClass("pick-b pick-n pick-h"),i++;for(d=1;d<=l(e);d++)a.find("li").eq(i).html(d).addClass("pick-n pick-v").attr("data-value",d),i++;if(a.find("li.pick-n").length<42){var r=42-a.find("li.pick-n").length;for(d=1;d<=r;d++)a.find("li").eq(i).html(d).addClass("pick-a pick-n pick-h"),i++}T[M.id].lock&&("from"===T[M.id].lock?p("y")<=k("y")&&(p("m")==k("m")?F('.pick-lg .pick-lg-b li.pick-v[data-value="'+k("d")+'"]').prevAll("li").addClass("pick-lk"):p("m")<k("m")?F(".pick-lg .pick-lg-b li").addClass("pick-lk"):p("m")>k("m")&&p("y")<k("y")&&F(".pick-lg .pick-lg-b li").addClass("pick-lk")):p("y")>=k("y")&&(p("m")==k("m")?F('.pick-lg .pick-lg-b li.pick-v[data-value="'+k("d")+'"]').nextAll("li").addClass("pick-lk"):p("m")>k("m")?F(".pick-lg .pick-lg-b li").addClass("pick-lk"):p("m")<k("m")&&p("y")>k("y")&&F(".pick-lg .pick-lg-b li").addClass("pick-lk"))),T[M.id].disabledays&&x.each(T[M.id].disabledays,function(i,a){if(a&&E(a)){var e=new Date(1e3*a);e.getMonth()+1==p("m")&&e.getFullYear()==p("y")&&F('.pick-lg .pick-lg-b li.pick-v[data-value="'+e.getDate()+'"]').addClass("pick-lk")}}),F(".pick-lg-b li.pick-v[data-value="+p("d")+"]").addClass("pick-sl")},B=function(){var a,e,i;M.element.hasClass("picker-lg")&&z(),a=p("m"),e=p("y"),i=e%4==0&&(e%100!=0||e%400==0),T[M.id].key.d.max=[31,i?29:28,31,30,31,30,31,31,30,31,30,31][a-1],p("d")>T[M.id].key.d.max&&(T[M.id].key.d.current=T[M.id].key.d.max,I("d",p("d"))),F(".pick-d li").removeClass("pick-wke").each(function(){var i=new Date(a+"/"+x(this).attr("value")+"/"+e).getDay();x(this).find("span").html(D[T[M.id].lang].weekdays.full[i]),0!=i&&6!=i||x(this).addClass("pick-wke")}),M.element.hasClass("picker-lg")&&(F(".pick-lg-b li").removeClass("pick-wke"),F(".pick-lg-b li.pick-v").each(function(){var i=new Date(a+"/"+x(this).attr("data-value")+"/"+e).getDay();0!=i&&6!=i||x(this).addClass("pick-wke")})),W()},I=function(i,a){var e,t=g(i);(t.find("li").removeClass("pick-sl pick-bfr pick-afr"),a==h(i,"last"))&&((e=t.find('li[value="'+h(i,"first")+'"]')).clone().insertAfter(t.find("li[value="+a+"]")),e.remove());a==h(i,"first")&&((e=t.find('li[value="'+h(i,"last")+'"]')).clone().insertBefore(t.find("li[value="+a+"]")),e.remove());t.find("li[value="+a+"]").addClass("pick-sl"),t.find("li.pick-sl").nextAll("li").addClass("pick-afr"),t.find("li.pick-sl").prevAll("li").addClass("pick-bfr")},q=function(i,a){var e=T[M.id].key[i];a>e.max&&("d"==i&&P("m","right"),"m"==i&&P("y","right"),a=e.min),a<e.min&&("d"==i&&P("m","left"),"m"==i&&P("y","left"),a=e.max),T[M.id].key[i].current=a,I(i,a)},P=function(i,a){var e=p(i);"right"==a?e++:e--,q(i,e)},H=function(){M.element.addClass("picker-rmbl")},N=function(i){return i<10?"0"+i:i},W=function(){if(!s()&&j){var i=p("d"),a=p("m"),e=p("y"),t=new Date(a+"/"+i+"/"+e).getDay(),l=T[M.id].format.replace(/\b(d)\b/g,N(i)).replace(/\b(m)\b/g,N(a)).replace(/\b(S)\b/g,(n=i,d=["th","st","nd","rd"],r=n%100,n+(d[(r-20)%10]||d[r]||d[0]))).replace(/\b(Y)\b/g,e).replace(/\b(U)\b/g,O(m())).replace(/\b(D)\b/g,D[T[M.id].lang].weekdays.short[t]).replace(/\b(l)\b/g,D[T[M.id].lang].weekdays.full[t]).replace(/\b(F)\b/g,D[T[M.id].lang].months.full[a-1]).replace(/\b(M)\b/g,D[T[M.id].lang].months.short[a-1]).replace(/\b(n)\b/g,a).replace(/\b(j)\b/g,i).split("/").join(".");M.input.val(l).change(),j=!1}var n,d,r};if(c())var Q={i:"touchstart",m:"touchmove",e:"touchend"};else Q={i:"mousedown",m:"mousemove",e:"mouseup"};var U="div.datedropper.picker-focus";x(document).on("click",function(i){M&&(M.input.is(i.target)||M.element.is(i.target)||0!==M.element.has(i.target).length||(S(),l=null))}).on(e,U+".picker-rmbl",function(){M.element.hasClass("picker-rmbl")&&x(this).removeClass("picker-rmbl")}).on(a,".picker-modal-overlay",function(){x(this).remove()}).on(Q.i,U+" .pick-lg li.pick-v",function(){F(".pick-lg-b li").removeClass("pick-sl"),x(this).addClass("pick-sl"),T[M.id].key.d.current=x(this).attr("data-value"),I("d",x(this).attr("data-value")),j=!0}).on("click",U+" .pick-btn-sz",function(){v()}).on("click",U+" .pick-btn-lng",function(){b()}).on(Q.i,U+" .pick-arw.pick-arw-s2",function(i){i.preventDefault(),l=null;x(this).closest("ul").data("k");var a,e=T[M.id].jump;a=x(this).hasClass("pick-arw-r")?p("y")+e:p("y")-e;var t=f("y",e);a>t[t.length-1]&&(a=t[0]),a<t[0]&&(a=t[t.length-1]),T[M.id].key.y.current=a,I("y",p("y")),j=!0}).on(Q.i,U+" .pick-arw.pick-arw-s1",function(i){i.preventDefault(),l=null;var a=x(this).closest("ul").data("k");x(this).hasClass("pick-arw-r")?P(a,"right"):P(a,"left"),j=!0}).on(Q.i,U+" ul.pick.pick-y li",function(){r=!0}).on(Q.e,U+" ul.pick.pick-y li",function(){if(r&&!(T[M.id].jump>=T[M.id].key.y.max-T[M.id].key.y.min)){x(this).closest("ul").toggleClass("pick-jump");var i=function(i,a){for(var e=a[0],t=Math.abs(i-e),l=0;l<a.length;l++){var n=Math.abs(i-a[l]);n<t&&(t=n,e=a[l])}return e}(p("y"),f("y",T[M.id].jump));T[M.id].key.y.current=i,I("y",p("y")),r=!1}}).on(Q.i,U+" ul.pick.pick-d li",function(){r=!0}).on(Q.e,U+" ul.pick.pick-d li",function(){r&&(v(),r=!1)}).on(Q.i,U+" ul.pick.pick-l li",function(){r=!0}).on(Q.e,U+" ul.pick.pick-l li",function(){var i;r&&(b(),i=x(this).val(),T[M.id].lang=Object.keys(D)[i],C(),B(),r=!1)}).on(Q.i,U+" ul.pick",function(i){if(l=x(this)){var a=l.data("k");n=c()?i.originalEvent.touches[0].pageY:i.pageY,d=p(a)}}).on(Q.m,function(a){if(r=!1,l){a.preventDefault();var e=l.data("k");o=c()?a.originalEvent.touches[0].pageY:a.pageY,o=n-o,o=Math.round(.026*o),i=d+o;var t=y(e,i);t!=T[M.id].key[e].current&&q(e,t),j=!0}}).on(Q.e,function(i){l&&(d=n=l=null),M&&B()}).on(Q.i,U+" .pick-submit",function(){S()}),x(window).resize(function(){M&&(w(),t())}),x.fn.dateDropper=function(i){return x(this).each(function(){if(x(this).is("input")&&!x(this).hasClass("picker-input")){var i=x(this),a="datedropper-"+Object.keys(T).length;i.attr("data-id",a).addClass("picker-input").prop({type:"text",readonly:!0});var e=i.data("default-date")?i.data("default-date"):null,t=i.data("disabled-days")?i.data("disabled-days").split(","):null,l="d/m/Y",n=!1!==i.data("fx")||i.data("fx"),d=!1===i.data("fx")?"":"picker-fxs",r=!1!==i.data("fx-mobile")||i.data("fx-mobile"),c=!1!==i.data("init-set"),s=i.data("lang")&&i.data("lang")in D?i.data("lang"):"en",o=!0===i.data("large-mode"),p=!0===i.data("large-default")&&!0===o?"picker-lg":"",k=("from"==i.data("lock")||"to"==i.data("lock"))&&i.data("lock"),u=i.data("jump")&&A(i.data("jump"))?i.data("jump"):10,m=i.data("max-year")&&A(i.data("max-year"))?i.data("max-year"):(new Date).getFullYear(),f=i.data("min-year")&&A(i.data("min-year"))?i.data("min-year"):1970,y=!0===i.data("modal")?"picker-modal":"",g=i.data("theme")||"primary",h=!0===i.data("translate-mode");if(t&&x.each(t,function(i,a){a&&E(a)&&(t[i]=O(a))}),T[a]={disabledays:t,format:l,fx:n,fxmobile:r,lang:s,large:o,lock:k,jump:u,key:{m:{min:1,max:12,current:1,today:(new Date).getMonth()+1},d:{min:1,max:31,current:1,today:(new Date).getDate()},y:{min:f,max:m,current:f,today:(new Date).getFullYear()},l:{min:0,max:Object.keys(D).length-1,current:0,today:0}},translate:h},e){var v=e.match(/\d+/g);x.each(v,function(i,a){v[i]=parseInt(a)}),T[a].key.d.today=v[0]<=31?v[0]:T[a].key.d.today,T[a].key.m.today=v[1]<=12?v[1]:T[a].key.m.today,T[a].key.y.today=v[2]?v[2]:T[a].key.y.today,T[a].key.y.today>T[a].key.y.max&&(T[a].key.y.max=T[a].key.y.today),T[a].key.y.today<T[a].key.y.min&&(T[a].key.y.min=T[a].key.y.today)}for(var b in x("<div>",{class:"datedropper "+y+" "+g+" "+d+" "+p,id:a,html:x("<div>",{class:"picker"})}).appendTo("body"),M={id:a,input:i,element:x("#"+a)},T[a].key)x("<ul>",{class:"pick pick-"+b,"data-k":b}).appendTo(F(".picker")),J(b);if(T[a].large){x("<div>",{class:"pick-lg"}).insertBefore(F(".pick-d")),x('<ul class="pick-lg-h"></ul><ul class="pick-lg-b"></ul>').appendTo(F(".pick-lg"));for(var w=Y(),C=0;C<7;C++)x("<li>",{html:D[T[M.id].lang].weekdays.short[w[C]]}).appendTo(F(".pick-lg .pick-lg-h"));for(C=0;C<42;C++)x("<li>").appendTo(F(".pick-lg .pick-lg-b"))}x("<div>",{class:"pick-btns"}).appendTo(F(".picker")),x("<div>",{class:"pick-submit"}).appendTo(F(".pick-btns")),T[M.id].translate&&x("<div>",{class:"pick-btn pick-btn-lng"}).appendTo(F(".pick-btns")),T[M.id].large&&x("<div>",{class:"pick-btn pick-btn-sz"}).appendTo(F(".pick-btns")),c&&(j=!0,W()),M=null}}).focus(function(i){i.preventDefault(),x(this).blur(),M&&S(),M={id:x(this).data("id"),input:x(this),element:x("#"+x(this).data("id"))},t(),w(),B(),M.element.toggleClass("picker-focus"),M.element.hasClass("picker-modal")&&x("body").append('<div class="picker-modal-overlay"></div>')})}}(jQuery);